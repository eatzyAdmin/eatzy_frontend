server {
  listen 80;
  server_name eatzy.local;

  # --- CUSTOMER APP ---
  location /customer/ {
    proxy_pass http://127.0.0.1:3000/customer/;
    proxy_http_version 1.1;

    # Websocket/HMR for Next.js dev
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- DRIVER APP ---
  location /driver/ {
    proxy_pass http://127.0.0.1:3001/driver/;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- RESTAURANT APP ---
  location /restaurant/ {
    proxy_pass http://127.0.0.1:3002/restaurant/;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- ADMIN APP ---
  location /admin/ {
    proxy_pass http://127.0.0.1:3003/admin/;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- SUPER ADMIN APP ---
  location /super-admin/ {
    proxy_pass http://127.0.0.1:3004/super-admin/;
    proxy_http_version 1.1;

    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Optional: Root redirect to customer app
  location = / {
    return 302 /customer;
  }
}
